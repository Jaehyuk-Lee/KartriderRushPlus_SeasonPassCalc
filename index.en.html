<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1" />
    <link rel="stylesheet" href="./style.css">
    <title>Kartrider SeasonPass Calculator</title>
    <script>
        const season1End = new Date('2020-07-16T23:59:59Z');

        function maxLengthCheck(object) {
            if (object.value.length > object.maxLength) {
                object.value = object.value.slice(0, object.maxLength);
            }
        }

        function toggleWeeklyQuest(object) {
            if (object.checked)
                document.getElementById("weeklyQuest").classList.remove('display-none');
            else
                document.getElementById("weeklyQuest").classList.add('display-none');
        }

        function findRemainingDates() {
            const timezone = parseInt(document.getElementById("time-zone").value);
            let baseDate = new Date(season1End.getTime());
            baseDate.setHours(season1End.getHours() + timezone);
            return Math.floor((new Date(baseDate) - new Date()) / 1000 / 60 / 60 / 24);
        }

        function refreshRemainingDates() {
            document.getElementById("remainDate").innerText = findRemainingDates();
        }

        function calculate() {
            if (!document.getElementById("targetLevel").value || !document.getElementById("remainPoint").value) {
                alert("Please enter all fields.");
                return;
            }

            let b_RoyalPass = document.getElementById("royalPass").checked;

            // toggle royalPass information
            for (let i = 0; i < document.getElementsByClassName("royal").length; i++) {
                if (b_RoyalPass)
                    document.getElementsByClassName("royal")[i].classList.remove('display-none');
                else
                    document.getElementsByClassName("royal")[i].classList.add('display-none');
            }

            let remainingDate = findRemainingDates();
            let targetLevel = parseInt(document.getElementById("targetLevel").value || 1);
            let remainPoint = parseInt(document.getElementById("remainPoint").value || 0);
            let nowLevel = parseInt(document.getElementById("nowLevel").value || 1);
            let freeLevel = document.getElementById("prev-120").checked ? 10 : 0;

            let needPoint = (targetLevel - freeLevel - nowLevel - 1) * 100 + remainPoint;
            document.getElementById("needPoint").innerText = needPoint;
            document.getElementById("needPointPerDay").innerText = Math.ceil(needPoint / remainingDate);

            let dailyPoint = b_RoyalPass ? 195 : 180;
            if (!document.getElementById('noFriend').checked) {
                dailyPoint -= b_RoyalPass ? 11 : 10;
            }
            let clearedWeekly = parseInt(document.getElementById("clearedWeeklyQuest").value || 0);
            let needDay = Math.ceil(needPoint / dailyPoint);
            let needDay_clearWeekly = Math.ceil((needPoint - (9 - clearedWeekly) * 750) / dailyPoint);

            document.getElementById("needDay").innerText = needDay;
            document.getElementById("needDay-clearWeekly").innerText = needDay_clearWeekly;
            document.getElementById("needPointPerDay-clearWeekly").innerText = Math.ceil((needPoint - (9 - clearedWeekly) * 750) / remainingDate);
            let possibleLevel;
            if (b_RoyalPass)
                possibleLevel = (remainingDate * dailyPoint - remainPoint + (9 - clearedWeekly) * 750) / 100 + 1 + nowLevel + freeLevel;
            else
                possibleLevel = (remainingDate * dailyPoint - remainPoint) / 100 + 1 + nowLevel + freeLevel;
            document.getElementById("possibleLevel").innerText = Math.floor(possibleLevel);

            if (b_RoyalPass && needDay_clearWeekly < remainingDate || !b_RoyalPass && needDay < remainingDate)
                document.getElementById("possibleOrNot").innerText = "Possible to achieve your goal.";
            else
                document.getElementById("possibleOrNot").innerText = "Impossible to achieve your goal.";
        }
    </script>
</head>

<body>
    <h1>Kartrider SeasonPass Calculator</h1>

    <h2>Season 1</h2>
    <b>Season 1: 2020.05.12 ~ 2020.07.16</b><br>
    <b>Remaining Dates: <span id="remainDate"></span>Days</b>(<span class="underline">Except today</span>)<br>
    <div class="inputDesc"><span>Server Time: </span>
        <select id="time-zone" onchange="javascript:refreshRemainingDates()">
            <option value="+7">West (UTC-8)</option>
            <option value="-8">SEA (UTC+8)</option>
            <option value="-8">East Asia (UTC+8)</option>
            <option value="-9">KR (UTC+9)</option>
        </select>
    </div>
    <div class="inputDesc display-none prev-120"><span>Free +10 level?</span><input type="checkbox" id="prev-120"></div>
    <div class="inputDesc"><span>Do you clear friend quest?</span><input type="checkbox" id="noFriend"></div>
    <div class="inputDesc"><span>Did you buy PremiumPass?</span><input type="checkbox" id="royalPass"
            onchange="toggleWeeklyQuest(this)"></div>
    <div class="inputDesc display-none" id="weeklyQuest"><span>Cleared Challenge Week:</span> <input type="number"
            id="clearedWeeklyQuest" maxlength="1" min="0" max="9" oninput="maxLengthCheck(this)">Weeks (0-9)</div>
    <div class="inputDesc"><span>Your Pass Level:</span> <input type="number" id="nowLevel" maxlength="3" min="1"
            max="999" oninput="maxLengthCheck(this)" value="1">Level</div>
    <div class="inputDesc"><span>Points before next level:</span> <input type="number" id="remainPoint" maxlength="3" min="0"
            max="100" oninput="maxLengthCheck(this)">Points</div>
    <div class="inputDesc"><span>Target Level:</span> <input type="number" id="targetLevel" maxlength="3" min="1" max="200"
            oninput="maxLengthCheck(this)">Level</div>
    <div class="button" onclick="calculate()">Calculate</div>
    <h4>Calculations below do not include today.</h4>
    <div>Needed Points: <span id="needPoint">0</span>Points</div>
    <div>Days with Daily Maximum Rewards: <span id="needDay">0</span>Days</div>
    <div>Needed Points Per Day: <span id="needPointPerDay">0</span>Points</div>
    <div class="display-none royal">Clear All Challenges + Days with Daily Maximum Rewards: <span id="needDay-clearWeekly">0</span>Days</div>
    <div class="display-none royal">Clear All Challenges + Needed Points Per Day: <span id="needPointPerDay-clearWeekly">0</span>Points
    </div>
    <div class="bold red" id="possibleOrNot">Possible to achieve your goal.</div>
    <div>Theoretically Maximum Level: <span id="possibleLevel">0</span>Level</div>

    <h2>Season Pass Basic Facts</h2>
    FreePass Daily Maximum Rewards: 180Points<br>
    PremiumPass Daily Maximum Rewards: 195Points<br>
    PremiumPass Challenge Weekly Rewards: 750Points Per Week
</body>
<footer>
    <p>
        다른 언어로 보기: <a href="https://jaehyuk-lee.github.io/KartriderRushPlus_SeasonPassCalc/">한국어</a>
    </p>
    <ul>
        <li>developer email: alex00728@outlook.com</li>
        <li>Github Repo: <a href="https://github.com/Jaehyuk-Lee/KartriderRushPlus_SeasonPassCalc" target="_blank">
            https://github.com/Jaehyuk-Lee/KartriderRushPlus_SeasonPassCalc</a></li>
    </ul>
</footer>

<script>
    refreshRemainingDates();
    if (findRemainingDates() < 0)
        document.getElementsByClassName("prev-120")[0].classList.remove('display-none');
</script>

</html>